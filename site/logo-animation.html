<!-- logo-animation.html -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const brandLink = document.querySelector(".navbar-brand");
    const logoImg = brandLink.querySelector("img.navbar-logo");

    const video = document.createElement("video");
    video.classList.add("navbar-logo", "video-logo");
    video.autoplay = true;
    video.muted = true;
    video.playsInline = true;
    video.loop = false;
    video.playbackRate = 2.0;

    const source = document.createElement("source");
    source.src = "./site/logo_movie.mp4";
    source.type = "video/mp4";
    video.appendChild(source);

    // Wait for the video to be loaded before showing it
    video.addEventListener("loadeddata", function () {
      video.classList.add("ready");
    });

    // If the final frame of video element is chosen as logo, it looks bad because it's not
    // anti-aliased. To solve this, we establish a cross-fade where the static
    // image is set to visible with an opacity transition, while the video fades.
    // out. Once the video fades out completely, it is removed.
    video.addEventListener("ended", function () {
      logoImg.classList.add('visible');
      video.classList.remove("ready");

      setTimeout(() => {
        video.remove();
      }, 1000);
    });

    video.addEventListener("error", function () {
      console.error("Video playback error");
      logoImg.style.visibility = "visible";
      video.remove();
    });

    brandLink.appendChild(video);
  });
</script>
